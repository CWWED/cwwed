version: '2'

services:

  postgis:
    image: mdillon/postgis
    ports:
      - "5432:5432"
    volumes:
      - cwwed-postgresql:/var/lib/postgresql/data

  thredds:
    image: unidata/thredds-docker:4.6.11
    ports:
      - "9000:8080"
    container_name: thredds
    volumes:
      - ./configs/thredds/catalog.xml:/usr/local/tomcat/content/thredds/catalog.xml:ro
      - ./configs/thredds/threddsConfig.xml:/usr/local/tomcat/content/thredds/threddsConfig.xml:ro
      - /media/bucket/cwwed:/usr/local/tomcat/content/thredds/public:ro
    env_file:
      - "compose.thredds.env"

  rabbitmq:
    image: rabbitmq
    container_name: rabbitmq
    ports:
      - "5672:5672"

  #cwwed:
  #  build:
  #    context: .
  #  ports:
  #    - "8888:80"
  #  env_file: .env  # not in version control
  #  environment:
  #    DJANGO_SETTINGS_MODULE: cwwed.settings
  #    DATABASE_URL: postgis://postgres@postgis:5432/postgres
  #  depends_on:
  #    - postgis
  #    - thredds
  #    - rabbitmq

volumes:
  cwwed-postgresql:
