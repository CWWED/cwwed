<div class="position-relative">

  <ngx-loading [show]="isLoading"></ngx-loading>
  <div class="card">
    <div class="card-header">
      <h1>Sandy</h1>
    </div>
    <div class="card-body">
      <div class="card-title">
        <h5>Delaware Bay</h5>
      </div>
      <div class="card-text">
        This is the DFLow FM simulation on Delaware Bay and River domain. Dflow was forced with GFS winds during the spinup period and with HWRF winds during
        the simulation. The computational domain covers Delaware River and Bay up to the mouth of the Bay.
      </div>
      <div class="row">

				<div class="col-lg-4 mt-3">
          <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
            <ngb-panel title="Map Layers">
              <ng-template ngbPanelContent>
                <div class="form-group">
                  <label>Variable</label>
                  <select [formControl]="contourVariableInput" class="form-control">
                    <option value="mesh2d_waterdepth">Water Depth</option>
                    <option value="mesh2d_windx">Wind X</option>
                    <option value="mesh2d_windy">Wind Y</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Data Opacity</label>
                  <input type="number" step=".1" min=".1" max="1" [formControl]="mapDataOpacityInput" class="form-control form-control-sm">
                </div>
              </ng-template>
            </ngb-panel>
            <ngb-panel title="Base Maps">
              <ng-template ngbPanelContent>
                <div class="form-check" *ngFor="let option of mapLayerOptions">
                  <input class="form-check-input" type="radio" [formControl]="mapLayerInput" [value]="option.value" [id]="'base-map-'+option.value" name="base-map">
                  <label class="form-check-label" [for]="'base-map-'+option.value">
                    {{ option.name }}
                  </label>
                </div>
              </ng-template>
            </ngb-panel>
            <ngb-panel title="Filters">
              <ng-template ngbPanelContent>
                <div class="form-group">
                  <label>Date: {{ getContourDateFormatted(contourDateInput.value) }}</label>
                  <input type="range" [formControl]="contourDateInput" min="0" [max]="getDateInputMax()" class="w-100">
                </div>
                <div>
                  <small>Start: {{ getDateMin() }}</small>
                </div>
                <div>
                  <small>End: {{ getDateMax() }}</small>
                </div>
              </ng-template>
            </ngb-panel>
            <ngb-panel title="Get Data">
              <ng-template ngbPanelContent>
                <dl class="row">
                  <dt class="col-sm-6">OPeNDAP</dt>
                  <dd class="col-sm-6">
                    <a [href]="demoDataURL" target="_blank">
                      <span class="oi oi-cloud-download"></span>
                    </a>
                  </dd>
                  <dt class="col-sm-6">Selected Data</dt>
                  <dd class="col-sm-6">
                    <a *ngIf="extentCoords" [href]="filteredDownloadURL()">Download</a>
                    <i *ngIf="!extentCoords">(none selected)</i>
                  </dd>
                </dl>
              </ng-template>
            </ngb-panel>
          </ngb-accordion>
        </div>

        <div class="col mt-3">

          <div id="map" class="position-relative">
            <ngx-loading [show]="isLoadingMap"></ngx-loading>
            <div #popup class="ol-popup">
              <div class="position-relative">
                <ngx-loading [show]="!popupContent"></ngx-loading>
              </div>
              <button (click)="closePopup()" class="ol-popup-closer"></button>
              <div>{{ popupContent }}</div>
            </div>
            <div id="map-info" *ngIf="currentFeature && !extentCoords" [class.confident]="currentConfidence >= 90">
              {{ currentFeature.title }} {{ variableUnit() }} ({{ currentConfidence }}% confidence)
            </div>
          </div>

          <small class="d-block"><sup>1</sup>Hold <i>Shift</i> and drag to select a box to filter the data to download.</small>
          <small class="d-block"><sup>2</sup>Hover to see feature information.</small>

          <p>
						<button class="btn btn-outline-info btn-sm" (click)="openModal(content)"><span class="oi oi-video"></span> Watch Time Series Video</button>
          </p>

        </div>
      </div>
    </div>
  </div>

  <ng-template #content let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Time Series Video</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <video controls class="w-100">
        <source [src]="currentAnimationURL()" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </ng-template>

</div>
